blueprint:
  name: "Dynamic Temperature-based Climate Control"
  description: "Control a climate device based on temperature sensor readings with customizable thresholds and dynamic settings"
  domain: automation
  input:
    climate_entity:
      name: Climate Device
      selector:
        entity:
          domain: climate
    temperature_sensor:
      name: Temperature Sensor
      selector:
        entity:
          domain: sensor
          device_class: temperature
    base_temperature_input:
      name: Base Temperature Input
      description: "The input_number entity for base temperature"
      selector:
        entity:
          domain: input_number
    upper_threshold:
      name: Upper Threshold
      description: "Temperature difference above base to trigger cooling"
      selector:
        number:
          min: 0
          max: 10
          step: 0.5
          unit_of_measurement: "°C"
    lower_threshold:
      name: Lower Threshold
      description: "Temperature difference below base to turn off climate"
      selector:
        number:
          min: 0
          max: 10
          step: 0.5
          unit_of_measurement: "°C"
    enable_automation_input:
      name: Enable Automation Input
      description: "The input_boolean entity to enable or disable the automation"
      selector:
        entity:
          domain: input_boolean

variables:
  climate_entity: !input climate_entity
  temperature_sensor: !input temperature_sensor
  base_temperature_input: !input base_temperature_input
  upper_threshold: !input upper_threshold
  lower_threshold: !input lower_threshold
  enable_automation_input: !input enable_automation_input

trigger:
  - platform: numeric_state
    entity_id: !input temperature_sensor
    above: "{{ states(base_temperature_input) | float + upper_threshold }}"
  - platform: numeric_state
    entity_id: !input temperature_sensor
    below: "{{ states(base_temperature_input) | float - lower_threshold }}"
  - platform: state
    entity_id: !input enable_automation_input
  - platform: state
    entity_id: !input base_temperature_input

condition:
  - condition: state
    entity_id: !input enable_automation_input
    state: "on"

action:
  - choose:
      - conditions:
          - condition: numeric_state
            entity_id: !input temperature_sensor
            above: "{{ states(base_temperature_input) | float + upper_threshold }}"
        sequence:
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climate_entity
            data:
              hvac_mode: cool
      - conditions:
          - condition: numeric_state
            entity_id: !input temperature_sensor
            below: "{{ states(base_temperature_input) | float - lower_threshold }}"
        sequence:
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climate_entity
            data:
              hvac_mode: "off"
