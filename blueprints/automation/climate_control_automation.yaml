blueprint:
  name: Climate Control Automation
  description: Automatically control an air conditioner with heating capability based on temperature sensor readings
  domain: automation
  input:
    climate_entity:
      name: Climate Entity
      description: The air conditioner/climate device to control (must support heating mode)
      selector:
        entity:
          filter:
            - domain: climate
    temperature_sensor:
      name: Temperature Sensor
      description: The temperature sensor to monitor for automation triggers
      selector:
        entity:
          filter:
            - domain: sensor
              device_class: temperature
    min_temperature:
      name: Minimum Temperature Threshold
      description: Temperature below which heating should activate (°C or °F depending on your system)
      default: 18
      selector:
        number:
          min: 5
          max: 35
          step: 0.5
          unit_of_measurement: "°"
          mode: box
    target_temperature:
      name: Target/Desired Temperature
      description: Temperature at which heating should deactivate (°C or °F depending on your system)
      default: 22
      selector:
        number:
          min: 10
          max: 40
          step: 0.5
          unit_of_measurement: "°"
          mode: box
    active_start_time:
      name: Active Start Time
      description: Time when the automation should start being active each day
      default: "09:00:00"
      selector:
        time:
    active_end_time:
      name: Active End Time
      description: Time when the automation should stop being active each day
      default: "21:00:00"
      selector:
        time:
    active_days:
      name: Active Days
      description: Days of the week when the automation should be active
      default:
        - mon
        - tue
        - wed
        - thu
        - fri
        - sat
        - sun
      selector:
        select:
          multiple: true
          mode: dropdown
          options:
            - label: Monday
              value: mon
            - label: Tuesday
              value: tue
            - label: Wednesday
              value: wed
            - label: Thursday
              value: thu
            - label: Friday
              value: fri
            - label: Saturday
              value: sat
            - label: Sunday
              value: sun
    heating_delay:
      name: Heating Activation Delay
      description: How long the temperature must stay below minimum before activating heating
      default: 30
      selector:
        number:
          min: 1
          max: 120
          step: 1
          unit_of_measurement: "minutes"
          mode: box
    heating_duration:
      name: Heating Duration After Target Reached
      description: How long to keep heating on after reaching the target temperature
      default: 15
      selector:
        number:
          min: 0
          max: 120
          step: 1
          unit_of_measurement: "minutes"
          mode: box

variables:
  climate_entity: !input climate_entity
  temperature_sensor: !input temperature_sensor
  min_temperature: !input min_temperature
  target_temperature: !input target_temperature
  active_start_time: !input active_start_time
  active_end_time: !input active_end_time
  active_days: !input active_days
  heating_delay: !input heating_delay
  heating_duration: !input heating_duration

trigger:
  # Trigger when temperature drops below minimum threshold for configured delay
  - id: "temperature_low"
    platform: numeric_state
    entity_id: !input temperature_sensor
    below: !input min_temperature
    for:
      minutes: !input heating_delay
  # Trigger when temperature reaches or exceeds target temperature for configured duration
  - id: "temperature_high"
    platform: numeric_state
    entity_id: !input temperature_sensor
    above: !input target_temperature
    for:
      minutes: !input heating_duration

condition:
  # Ensure the temperature sensor is available
  - condition: not
    conditions:
      - condition: state
        entity_id: !input temperature_sensor
        state:
          - "unavailable"
          - "unknown"
  # Only active during specified time range and days
  - condition: time
    after: !input active_start_time
    before: !input active_end_time
    weekday: !input active_days

action:
  - choose:
      # When temperature is low, turn on heating
      - conditions:
          - condition: trigger
            id: "temperature_low"
          # Additional check to ensure climate entity is available
          - condition: not
            conditions:
              - condition: state
                entity_id: !input climate_entity
                state: 
                  - "unavailable"
                  - "unknown"
        sequence:
          - action: climate.set_temperature
            target:
              entity_id: !input climate_entity
            data:
              temperature: !input target_temperature
              hvac_mode: heat
          - action: logbook.log
            data:
              name: "Climate Control Automation"
              message: >
                Heating activated: Temperature {{ states(temperature_sensor) }}° dropped below {{ min_temperature }}° for {{ heating_delay }} minutes.
                Set {{ climate_entity }} to heat mode with target {{ target_temperature }}°.
                (Active: {{ active_start_time }} - {{ active_end_time }}, Days: {{ active_days | join(', ') }})
      
      # When temperature is high, turn off heating
      - conditions:
          - condition: trigger
            id: "temperature_high"
          # Additional check to ensure climate entity is available
          - condition: not
            conditions:
              - condition: state
                entity_id: !input climate_entity
                state: 
                  - "unavailable"
                  - "unknown"
        sequence:
          - action: climate.turn_off
            target:
              entity_id: !input climate_entity
          - action: logbook.log
            data:
              name: "Climate Control Automation"
              message: >
                Heating deactivated: Temperature {{ states(temperature_sensor) }}° reached {{ target_temperature }}° for {{ heating_duration }} minutes.
                Turned off {{ climate_entity }}.
                (Active: {{ active_start_time }} - {{ active_end_time }}, Days: {{ active_days | join(', ') }})

mode: single
